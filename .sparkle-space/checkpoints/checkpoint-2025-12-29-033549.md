# JSR Slow-Type Fixes - Session 1

## Status
- **Starting Errors**: 398
- **Current Errors**: 366
- **Errors Fixed**: 32 (8% reduction)

## Strategy Applied
Fixed internal const declarations with missing explicit type annotations by applying the Record<string, Field> pattern:

```typescript
// Pattern: Private const objects in schema files
const MeshParams: Record<string, Field> = {
    vertices: RequiredField(...),
    indices: RequiredField(...),
    // ...
};
```

This pattern satisfies JSR's requirement that all symbols in the public API (includes module-level consts) have explicit types.

## Files Fixed
1. **src/extensions/mvs/tree/mvs/mvs-tree-representations.ts** - 10 errors fixed
   - Applied Record<string, Field> to: Cartoon, Backbone, BallAndStick, Line, Spacefill, Carbohydrate, Surface, VolumeIsoSurface, VolumeGridSlice, ClipParamsBase

2. **src/extensions/mvs/tree/mvs/mvs-tree-primitives.ts** - 12 errors fixed  
   - Applied Record<string, Field> to: _TubeBase, MeshParams, LinesParams, TubeParams, ArrowParams, DistanceMeasurementParams, AngleMeasurementParams, PrimitiveLabelParams, EllipseParams, EllipsoidParams, BoxParams
   - Added import: `type Field` from field-schema

3. **src/extensions/mvs/tree/mvs/param-types.ts** - 10 errors fixed
   - Applied iots.LiteralType<T> to: ParseFormatT, MolstarParseFormatT, StructureTypeT, ComponentSelectorT, SchemaT, SchemaFormatT, LabelAttachments, ColorListNameT, ColorDictNameT
   - Applied iots.Type<T> to: HexColorT, ColorNameT (for new iots.Type() constructors)

## Key Insight
JSR considers module-level `export const` declarations as part of the public API and requires explicit type annotations. The pattern `const name: Record<string, Field> = {...}` works well for param schema objects because:
- It's explicit about the type
- It doesn't break the underlying functionality (spreads with ..._Base still work)
- It's minimal and doesn't require wrapping/factory patterns

For io-ts literals, using `iots.LiteralType<T>` provides the explicit return type needed.

## Remaining High-Impact Files
- src/mol-plugin-state/builder/structure/representation-preset.ts (11 errors)
- src/extensions/mvs/tree/animation/animation-tree.ts (11 errors)
- src/mol-repr/volume/isosurface.ts (10 errors)
- src/mol-gl/renderable/schema.ts (10 errors)
- src/mol-repr/volume/dot.ts (9 errors)
- src/mol-repr/volume/segment.ts (8 errors)
- src/mol-plugin/context.ts (8 errors)

Total remaining: ~77 errors in 7 files

## Next Steps
1. Apply same Record<string, Field> pattern to remaining schema files
2. Fix isosurface.ts, dot.ts, segment.ts (volume representation params)
3. Handle context.ts (likely event/manager objects)
4. Target completion: 398 â†’ ~0 errors (or --allow-slow-types acceptable level)